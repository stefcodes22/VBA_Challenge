Sub stocks2():    Dim ticker As String    Dim i, j As Integer    Dim yearly_value As Double    Dim Percent_change As Double    Dim total_volume As Double    Dim start As Double    For Each ws In Worksheets    j = 0    yearly_value = 0    Percent_change = 0    total_volume = 0    start = 2    Cells(1, 10) = "Ticker"    Cells(1, 11) = "Yearly value"    Cells(1, 12) = "Percent change"    Cells(1, 13) = "Total volume"       lastrow = Cells(Rows.Count, "A").End(xlUp).Row    For i = 2 To lastrow        If Cells(i + 1, 1).Value <> Cells(i, 1).Value Then            total_volume = total_volume + Cells(i, 7).Value            If total_volume = 0 Then                    Range("J" & 2 + j).Value = Cells(i, 1).Value                    Range("K" & 2 + j).Value = 0                    Range("L" & 2 + j).Value = "%" & 0                    Range("M" & 2 + j).Value = 0            Else                If Cells(start, 3).Value = 0 Then                    For find_value = start To i                        If Cells(find_value, 3).Value <> 0 Then                            start = find_value                                Exit For                        End If                                        Next find_value                                End If                yearly_value = (Cells(i, 6) - Cells(start, 3))                Percent_change = yearly_value / Cells(start, 3)                start = i + 1                Range("J" & 2 + j).Value = Cells(i, 1).Value                Range("K" & 2 + j).Value = yearly_value                Range("K" & 2 + j).NumberFormat = "0.00"                Range("L" & 2 + j).Value = Percent_change                Range("L" & 2 + j).NumberFormat = "0.00%"                Range("M" & 2 + j).Value = total_volume                            ' color coding                            Select Case yearly_value                    Case Is > 0                        Range("K" & 2 + j).Interior.ColorIndex = 4                    Case Is < 0                            Range("K" & 2 + j).Interior.ColorIndex = 3                        Case Else                            Range("K" & 2 + j).Interior.ColorIndex = 0                    End Select                    End If                    ' reset variables for new stock ticker                Total = 0                yearly_value = 0                j = j + 1                Days = 0                ' If ticker is still the same add results            Else                total_volume = total_volume + Cells(i, 7).Value                End If            Next i         Next ws        End Sub    